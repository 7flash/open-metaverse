{"version":3,"sources":["js/audioSocket.js","js/playerSocket.js","js/main.js"],"names":["peers","socket","configuration","urls","username","credential","initiateAudio","_socket","_peers","on","socket_id","console","log","addPeer","emit","removePeer","data","signal","am_initiator","localStream","navigator","mediaDevices","getUserMedia","audio","video","then","stream","SimplePeer","initiator","config","newVid","document","createElement","srcObject","id","playsinline","autoplay","className","body","appendChild","window","toggleMute","index","getAudioTracks","enabled","muteButton","innerText","videoEl","getElementById","getTracks","forEach","track","stop","parentNode","removeChild","destroy","initializePlayersSocket","self","otherPlayers","physics","add","group","players","Object","keys","playerId","addPlayer","addOtherPlayers","playerInfo","getChildren","otherPlayer","setRotation","rotation","setPosition","x","y","sprite","setSize","setOffset","setScale","test","createAnims","anims","play","cameras","main","startFollow","setBounds","create","key","frames","generateFrameNumbers","start","end","frameRate","repeat","keyUp","keyDown","keyLeft","keyRight","map","type","Phaser","AUTO","scale","mode","Scale","FIT","parent","autoCenter","CENTER_BOTH","width","height","default","arcade","debug","gravity","scene","preload","update","game","Game","i","load","spritesheet","frameWidth","frameHeight","margin","spacing","image","tilemapTiledJSON","input","keyboard","addKey","Input","Keyboard","KeyCodes","W","S","A","D","setZoom","button","dom","dungeon","make","tilemap","tileset","addTilesetImage","createStaticLayer","io","spriteSpeed","isDown","setFlipX","r","oldPosition"],"mappings":"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","file":"main.1855f058.js","sourceRoot":"../public","sourcesContent":["/**\n * RTCPeerConnection configuration \n */\n\n const configuration = {\n    // Using From https://www.metered.ca/tools/openrelay/\n    \"iceServers\": [\n    {\n      urls: \"stun:openrelay.metered.ca:80\"\n    },\n    {\n      urls: \"turn:openrelay.metered.ca:80\",\n      username: \"openrelayproject\",\n      credential: \"openrelayproject\"\n    },\n    {\n      urls: \"turn:openrelay.metered.ca:443\",\n      username: \"openrelayproject\",\n      credential: \"openrelayproject\"\n    },\n    {\n      urls: \"turn:openrelay.metered.ca:443?transport=tcp\",\n      username: \"openrelayproject\",\n      credential: \"openrelayproject\"\n    }\n  ]\n}\n\nvar peers;\nvar socket;\n// Initialize audio stream for socket\nexport function initiateAudio(_socket, _peers) {\n    peers = _peers;\n    socket = _socket;\n    socket.on('initReceive', socket_id => {\n        console.log('INIT RECEIVE ' + socket_id);\n        addPeer(socket_id, false)\n\n        socket.emit('initSend', socket_id)\n    })\n\n    socket.on('initSend', socket_id => {\n        console.log('INIT SEND ' + socket_id)\n        addPeer(socket_id, true)\n    })\n\n    socket.on('removePeer', socket_id => {\n        console.log('removing peer ' + socket_id)\n        removePeer(socket_id)\n    })\n\n    socket.on('signal', data => {\n        peers[data.socket_id].signal(data.signal)\n    })\n}\n\nfunction addPeer(socket_id, am_initiator, localStream) {\n\n    navigator.mediaDevices.getUserMedia({audio: true, video: false}).then(stream => {\n        let localStream = stream; \n        console.log('EOO'  + localStream);\n        peers[socket_id] = new SimplePeer({\n            initiator: am_initiator,\n            stream: localStream,\n            config: configuration\n        });\n        peers[socket_id].on('signal', data => {\n            socket.emit('signal', {\n                signal: data,\n                socket_id: socket_id\n            })\n        })\n    \n        peers[socket_id].on('stream', stream => {\n            console.log('Was here');\n            let newVid = document.createElement('video')\n            newVid.srcObject = stream\n            newVid.id = socket_id\n            newVid.playsinline = false\n            newVid.autoplay = true\n            newVid.className = \"vid\"\n            // append newVid to body\n            document.body.appendChild(newVid)\n        });\n        /**\n         * Enable/disable microphone\n         */\n        function toggleMute() {\n            console.log(\"Microphone has been toggled\");\n            for (let index in localStream.getAudioTracks()) {\n                localStream.getAudioTracks()[index].enabled = !localStream.getAudioTracks()[index].enabled\n                muteButton.innerText = localStream.getAudioTracks()[index].enabled ? \"Unmuted\" : \"Muted\"\n            }\n        }\n        \n        window.toggleMute = toggleMute;\n\n\n        \n    });\n    \n\n}\n\nexport function removePeer(socket_id) {\n\n    let videoEl = document.getElementById(socket_id)\n    if (videoEl) {\n\n        const tracks = videoEl.srcObject.getTracks();\n\n        tracks.forEach(function (track) {\n            track.stop()\n        })\n\n        videoEl.srcObject = null\n        videoEl.parentNode.removeChild(videoEl)\n    }\n    if (peers[socket_id]) peers[socket_id].destroy()\n    delete peers[socket_id]\n}","export function initializePlayersSocket(self, peers) {\n    self.otherPlayers = self.physics.add.group();\n\n    self.socket.on('currentPlayers', function (players) {\n        Object.keys(players).forEach(function (id) {\n        if (players[id].playerId === self.socket.id) {\n            addPlayer(self, players[id]);\n        } else {\n            addOtherPlayers(self, players[id]);\n        }\n        });\n    });\n    self.socket.on('newPlayer', function (playerInfo) {\n        addOtherPlayers(self, playerInfo);\n    });\n    \n    self.socket.on('playerMoved', function (playerInfo) {\n        self.otherPlayers.getChildren().forEach(function (otherPlayer) {\n        if (playerInfo.playerId === otherPlayer.playerId) {\n            otherPlayer.setRotation(playerInfo.rotation);\n            otherPlayer.setPosition(playerInfo.x, playerInfo.y);\n        }\n        });\n    });\n\n    // DISCONNECT FUNCTION ONLY HERE\n    // self.socket.on('disconnected', function (playerId) {\n    //     console.log('disconnected');\n\n    //     self.otherPlayers.getChildren().forEach(function (otherPlayer) {\n    //     if (playerId === otherPlayer.playerId) {\n    //         otherPlayer.destroy();\n    //     }\n    //     });\n    //     for (let socket_id in peers) {\n    //         removePeer(socket_id)\n    //     }\n    // });\n}\n\nfunction addPlayer(self, playerInfo) {\n    self.sprite = self.physics.add\n      .sprite(400, 400, \"characters\", 0)\n      .setSize(22, 33)\n      .setOffset(23, 27)\n      .setScale(0.5);\n    var test = self.add.sprite(400, 400, \"characters0\", 0).setSize(22, 33);\n    createAnims(self);\n    test.anims.play(\"hero-walk-down\");\n    self.sprite.anims.play(\"player-walk-back\");\n    self.cameras.main.startFollow(self.sprite, true);\n    self.cameras.main.setBounds(0, 0, 1000, 1000);\n  \n    // Change texts\n    //playerName = self.add.text(self.sprite.x, self.sprite.y, \"player\", { fontSize: '20px', color: '#ffffff' });\n}\n\nfunction addOtherPlayers(self, playerInfo) {\n    const otherPlayer = self.add.sprite(playerInfo.x, playerInfo.y, \"characters\", 0).setScale(0.5);\n    //const otherPlayerName = self.add.text(playerInfo.x, playerInfo.y, playerInfo.account, { fontSize: '20px', color: '#ffffff' });\n    otherPlayer.anims.play(\"player-walk\");\n    otherPlayer.playerId = playerInfo.playerId;\n    self.otherPlayers.add(otherPlayer);\n  \n    // const camera  = this.cameras.main;\n    // camera.setBounds(0, 0, 1400, 1400);\n}\n\n\nfunction createAnims(self) {\n    const anims = self.anims;\n    anims.create({\n        key: \"hero-walk-down\",\n        frames: anims.generateFrameNumbers(\"characters0\", { start: 0, end: 2 }),\n        frameRate: 8,\n        repeat: -1\n    });\n}\n","import { initiateAudio, removePeer } from './audioSocket';\nimport {initializePlayersSocket} from './playerSocket';\n/**\n * Socket.io socket\n */\nlet socket;\n\n/**\n * The stream object used to send media\n */\nlet localStream = null;\n\n/**\n * All peer connections\n */\nlet peers = {};\n\n\n/////////// PHASER 3 CONFIG ///////////\nvar config = {\n    type: Phaser.AUTO,\n    scale: {\n        mode: Phaser.Scale.FIT,\n        parent: 'phaser-example',\n        autoCenter: Phaser.Scale.CENTER_BOTH,\n        width: 1280,\n        height: 720,\n    },\n    physics: {\n      default: 'arcade',\n      arcade: {\n        debug: false,\n        gravity: { y: 0 }\n      }\n    },\n    scene: {\n      preload: preload,\n      create: create,\n      update: update\n    },\n};\n\nvar game = new Phaser.Game(config);\n\n// KEYS\nvar keyUp, keyDown, keyLeft, keyRight;\n\n\n// BACKGROUND\nvar map;\n\n\nfunction preload() {\n    for (let i = 0; i < 4; i++) {\n        this.load.spritesheet(`characters${i}`, \n        `assets/Other/${i}.png`,\n        {\n        frameWidth: 32,\n        frameHeight: 32,\n        margin: 0,\n        spacing: 0\n      });\n    }\n    this .load.image('tiles', 'assets/tiles/indoors.png');\n    this.load.tilemapTiledJSON('dungeon', 'assets/tiles/mainmap.json');\n    this.load.spritesheet(\n      \"characters\",\n      \"assets/characterSprite.png\",\n      {\n        frameWidth: 64,\n        frameHeight: 64,\n        margin: 1,\n        spacing: 2\n      }\n    );\n  \n    this.load.image('map', 'assets/mainMap.jpeg');\n  \n  \n    this.load.image('sprite', 'assets/spaceShips_001.png');\n  \n    this.load.image('star', 'assets/star_gold.png');\n    keyUp = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);\n    keyDown = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);\n    keyLeft = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);\n    keyRight = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);\n}\n\n\nfunction create() {\n\n    this.cameras.main.setZoom(3);\n    // create button\n    const button = document.createElement('div');\n    button.className = 'button';\n    button.innerText = 'muted';\n    this.add.dom(100, 100, button);\n\n    const dungeon = this.make.tilemap({ key: 'dungeon' });\n    const tileset = dungeon.addTilesetImage('indoors', 'tiles');\n\n    dungeon.createStaticLayer('background', tileset);\n    dungeon.createStaticLayer('structure', tileset);\n    //map = this.add.image(526, 495, 'map');\n    //map.setScale(2.1);\n\n\n    // ANIMS\n    const anims = this.anims;\n    anims.create({\n        key: \"player-walk\",\n        frames: anims.generateFrameNumbers(\"characters\", { start: 46, end: 49 }),\n        frameRate: 16,\n        repeat: -1\n    });\n    anims.create({\n        key: \"player-walk-back\",\n        frames: anims.generateFrameNumbers(\"characters\", { start: 65, end: 68 }),\n        frameRate: 16,\n        repeat: -1\n    });\n    \n    \n    \n\n\n\n    var self = this;\n    this.socket = io('ws://localhost:3000');\n    socket = this.socket;\n\n\n    // Initialize audio stream for socket\n    initiateAudio(socket, peers);\n    \n    // Initialize player socket\n    initializePlayersSocket(self, peers);\n      \n\n    socket.on('disconnected', (socket_id) => {\n      console.log('disconnected');\n\n      this.otherPlayers.getChildren().forEach(function (otherPlayer) {\n      if (socket_id === otherPlayer.playerId) {\n          otherPlayer.destroy();\n      }\n      });\n      for (let socket_id in peers) {\n          removePeer(socket_id)\n      }\n    });\n} \n\nconst spriteSpeed = 2;\n\nfunction update() {\n  \n    if (this.sprite) {\n\n      var sprite = this.sprite;\n      if (keyUp.isDown) {\n        sprite.y -= spriteSpeed;\n        //this.sprite.rotation = -3.14;\n      }\n      if (keyDown.isDown) {\n        sprite.y += spriteSpeed;\n        //this.sprite.rotation = 0;\n      }\n      if (keyLeft.isDown) {\n        sprite.x -= spriteSpeed;\n        //this.sprite.rotation = 3.14 / 2;\n        sprite.setFlipX(true);\n      }\n      if (keyRight.isDown) {\n        sprite.x += spriteSpeed;\n        //this.sprite.rotation = -3.14 / 2;\n        sprite.setFlipX(false);\n      }\n  \n      if (keyLeft.isDown || keyRight.isDown || keyDown.isDown) {\n        sprite.anims.play(\"player-walk\", true);\n      } else if (keyUp.isDown) {\n        sprite.anims.play(\"player-walk-back\", true);\n      } else {\n        sprite.anims.stop();\n      }\n  \n\n      // emit player movement\n      var x = this.sprite.x;\n      var y = this.sprite.y;\n      var r = this.sprite.rotation;\n      if (this.sprite.oldPosition && (x !== this.sprite.oldPosition.x || y !== this.sprite.oldPosition.y || r !== this.sprite.oldPosition.rotation)) {\n        this.socket.emit('playerMovement', { x: this.sprite.x, y: this.sprite.y, rotation: this.sprite.rotation });\n      }\n      // save old position data\n      this.sprite.oldPosition = {\n        x: this.sprite.x,\n        y: this.sprite.y,\n        rotation: this.sprite.rotation\n      };\n    }\n  }\n\n"]}